<!-- need more comments on this page,
- this is currently very hard to parse
-->  
{{ partial "header" . }}

<div id="siteMap">
  <table id="archiveTable" class="wide-screen-only">
    <thead>
      <tr>
        <th onclick="javascript:sortTable(0);">Name</th>
        <th class="sortDesc" onclick="javascript:sortTable(1);">Date</th>
      </tr>
    </thead>
    <tbody>
    {{range where $.Site.Pages.ByDate.Reverse "Type" "post"}}
    <tr>
      <td><a target="_parent" href="{{.Permalink}}" class="crosslink"> {{ .Title }} </a> </td>
      <td>{{ .Date.Format "06/01/02" }}</td>
    </tr>
    {{end}}
    </tbody>  
  </table>
      
  <div id="siteMapGrid">
    <div class="Title hline">
      <a target="_parent" class="crosslink" href="{{ $.Site.BaseURL | relURL }}">Archive</a>
      <div class="date">
        <a href="javascript:hideAllSections();" class="hideShowButton"> Collapse all</a> | <a href="javascript:showAllSections();" class="hideShowButton"> Expand all</a> <br> <br>
      </div>
    </div>
    
    
    {{ range where .Site.Home.Sections "Title" "ne" "_modules" }}
        {{ if .Sections }}
          <div class="grid-topSection wide-screen-only"> 
            {{.Title}}
          </div>
        {{ else }}
          <div class="grid-topSection dummy wide-screen-only"></div>
        {{ end }}
        {{ range .Sections}}
          {{ template "print_pages" .}}
          <div class="grid-topSection dummy wide-screen-only"></div>       
        {{ end }}
        
        {{ template "print_pages" .}}
        <div class="hline"></div>
    {{ end }}
    </div>
</div>

{{ define "print_pages"}}
    {{ if .Pages}}
            {{$.Scratch.Set "section" .Title}}   
            <div class="grid-section"> 
            <a class="hideShowButton" href="javascript:hideSections('{{.Title}}')" section="{{.Title}}">[â€“]</a>
            {{ template "add_content" (slice .Permalink .Title "categories") }} </div>
            {{ range .Pages }}
                <div class="grid-topSection dummy wide-screen-only" section="{{$.Scratch.Get "section"}}"></div>
                <div class="grid-title" section="{{$.Scratch.Get "section"}}">{{ template "add_content" (slice .Permalink .Title "")}}</div>
                <div class="wide-screen-only grid-date" section="{{$.Scratch.Get "section"}}">{{ .Date.Format "Jan 02" }}</div>
                <div class="grid-tags" section="{{$.Scratch.Get "section"}}">
                {{ range .Params.tags}}
                      {{ template "add_content" (slice (printf "%stags/%s/" $.Site.BaseURL (. | urlize) ) (printf "#%s" .) "tags") }}
                {{ end }}
                </div>
            {{ end }}
      {{ end }}
{{ end }}

{{ define "add_content"}}
    <a target="_parent"class="crosslink {{ index . 2}}" href="{{ index . 0 }}">
      {{ index . 1 }}
    </a>
{{ end }}

</body>
</html>



